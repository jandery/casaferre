<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        circle {
            fill: #ddd;
            stroke: #0074d9;
            stroke-width: 50;
            stroke-dasharray: 0 158;
            transition: stroke-dasharray .3s ease;
        }

        svg {
            margin: 0 auto;
            transform: rotate(-90deg);
            background: #ddd;
            border-radius: 50%;
            display: block;
        }
    </style>
    <script type="text/javascript" src="../js/libs/jquery-3.3.1.min.js"></script>

    <script type="text/javascript">

        class SwipeComponent {

            constructor(element) {

                this.centerX = element.offsetWidth / 2;
                this.centerY = element.offsetHeight / 2;

                this.startDegree = null;
                this.endDegree = null;
                this.previousDegree = null;
                this.laps = 0;

                element.addEventListener(
                    'touchstart',
                    (event) => {
                        this.laps = 0;
                        this.endDegree = null;
                        this.startDegree = this.calcDegree(event.touches[0].clientX, event.touches[0].clientY);
                    },
                    false);
                element.addEventListener(
                    'touchmove',
                    (event) => {
                        let currentDegree = this.calcDegree(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
                        if (this.previousDegree) {
                            if (this.previousDegree > 350 && currentDegree < 10) {
                                this.laps++;
                            } else if(this.previousDegree < 10 && currentDegree > 350) {
                                this.laps--;
                            }
                            element.style.transform = 'rotate(' + this.calcMove(currentDegree) + 'deg)';
                        }

                        this.previousDegree = currentDegree;
                    },
                    false);
                element.addEventListener(
                    'touchend',
                    (event) => {
                        this.endDegree = this.calcDegree(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
                        console.log("Move " + this.calcMove(this.endDegree));
                    },
                    false);
            }

            calcDegree(pointX, pointY) {
                let degree = Math.atan2(pointY - this.centerY, pointX - this.centerX) * 180 / Math.PI;
                return degree >= 0 ? degree : 360 + degree;
            }

            calcMove(degree) {
                return (this.laps * 360) + (degree - this.startDegree);
            }
        }


        const appendToLog = (msg) => {
            $("#log").append(`<div>${msg}</div>`);
        };

        const customEventExample = () => {
            document.body.addEventListener("myEventName", (e) => {console.log(e);}, false);
            var myEvent = new CustomEvent("myEventName", { detail: { key1: "value1", key2: "value2" } });
            document.body.dispatchEvent(myEvent);
        };

        $(document).ready(function () {
//            simulateEvent(document.getElementById("myElement"));
//            tourchEvents(document.getElementById("meAvatar"));

            let tada = new SwipeComponent(document.getElementById("meAvatar"))
        });

    </script>
</head>
<body>

<div id="myElement">TADA</div>

<img id="meAvatar" src="../imgs/me.png" style="width: 400px; height: 400px; border-radius: 50%;" alt="Avatar">

<h3>Log</h3>
<div id="log"></div>

</body>
</html>